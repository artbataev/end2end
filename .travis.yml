language: python
python:
- "3.5"

sudo: false
cache: pip

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-8
    - cmake

install:
- pip install -r requirements.txt
- pip install torch_nightly -f https://download.pytorch.org/whl/nightly/cpu/torch_nightly.html
- pip install -r docs/requirements.txt

before_script:
- sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-8 90

script:
  - cd "${TRAVIS_BUILD_DIR}/docs"
  - make html
  - cd "${TRAVIS_BUILD_DIR}"
  - python -m tests.test_ctc
  - python -m tests.test_ctc_decoder

deploy:
  - provider: pages
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    keep-history: true
    local-dir: docs/build/html
    on:
      branch: master
